# /usr/bin/env bash
# extract field 8 (MSLP), field 1 (GPH) and field 50 (max WS) to separate files
FNAME=$1

for FIELD in field8 field1;
do
    OUTNAME=${FNAME%.nc}_$FIELD"_daymn".nc
    ncks -O -v $FIELD $FNAME $OUTNAME
    # get rid of global_latitude0, etc.
    ncks -C -O -x -v global_latitude0,global_longitude0 $OUTNAME $OUTNAME
    # do the averaging
    cdo -O daymean $OUTNAME $OUTNAME"2"
    rm $OUTNAME
    mv $OUTNAME"2" $OUTNAME
    # fix the rotated grid
    # -a grid_mapping,$FIELD,c,c,"rotated_pole"
	ncks -A -v rotated_pole /Users/Neil/Coding/WaH/wah_eu_lsm_0.44.nc $OUTNAME
	ncatted -O -a grid_mapping,$FIELD,o,c,"rotated_pole" $OUTNAME
done

FIELD=field50
    OUTNAME=${FNAME%.nc}_$FIELD"_daymn".nc
    ncks -O -v $FIELD $FNAME $OUTNAME
    # get rid of global_latitude1, etc.
    ncks -C -O -x -v global_latitude1,global_longitude1 $OUTNAME $OUTNAME
    # do the averaging - wind speed gets daymax
    cdo -O daymax $OUTNAME $OUTNAME"2"
    rm $OUTNAME
    mv $OUTNAME"2" $OUTNAME
    # fix the rotated grid
    # -a grid_mapping,$FIELD,c,c,"rotated_pole"
	ncks -A -v rotated_pole /Users/Neil/Coding/WaH/wah_eu_lsm_0.44.nc $OUTNAME
	ncatted -O -a grid_mapping,$FIELD,o,c,"rotated_pole" $OUTNAME
